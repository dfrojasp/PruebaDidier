trigger:
  branches:
    include:
      - master  # Usando la rama master

pool:
  name: 'Default'  # Usando agente Windows
  
stages:
- stage: Build_and_Test
  displayName: Build and Test Automation Project
  jobs:
  - job: Run_Tests
    displayName: Build and Run Tests
    steps:
    # 1. Descargar el código desde el repositorio
    - task: Checkout@1
      displayName: "Clonar el código del repositorio"

    # 2. Compilar el proyecto y ejecutar pruebas
    - script: |
        echo Compilando el proyecto y ejecutando pruebas...
        gradlew clean test aggregate
      displayName: "Compilar y ejecutar pruebas con Gradle"

    # 3. Verificar los archivos generados
    - script: |
        echo "Archivos generados:"
        dir build/test-results/test/
      displayName: "Verificar archivos de resultados"

    # 4. Publicar resultados de pruebas (JUnit)
    - task: PublishTestResults@2
      inputs:
        testResultsFiles: '**/build/test-results/test/*.xml'  # Ruta corregida
        testRunTitle: 'Resultados de pruebas automatizadas'
